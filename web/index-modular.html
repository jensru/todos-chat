<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="ui-guidelines.js"></script>
    <script src="date-sync.js"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="main-container">
        <!-- Smart Task Dashboard - Left Side -->
        <div class="smart-dashboard">
            <div class="header">
                <div class="header-left">
                    <h1>üéØ Smart Task Dashboard</h1>
                    <p>Intelligente Task-Verwaltung mit AI-Unterst√ºtzung</p>
                </div>
                <div class="header-right">
                    <button class="btn btn-primary" data-action="create-task" title="Neuen Task erstellen">
                        ‚ûï Neuer Task
                    </button>
                    <button class="btn btn-secondary" onclick="openCategoryManagementModal()" title="Kategorien verwalten">
                        üìÅ Kategorien
                    </button>
                </div>
                <div class="header-right">
                    <div class="current-date" id="currentDate">Lade Datum...</div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <div class="search-input-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="üîç Nach Tasks suchen..." data-search>
                    <button class="search-clear-btn" onclick="clearSearch()" title="Suche l√∂schen">‚úï</button>
                </div>
            </div>
            
            <!-- Filter & Sortierung Bar -->
            <div class="filter-sort-bar">
                <div class="filter-section">
                    <button class="filter-btn active" data-filter="today">Heute</button>
                    <button class="filter-btn" data-filter="week">Diese Woche</button>
                    <button class="filter-btn" data-filter="tomorrow">Morgen</button>
                    <button class="filter-btn" data-filter="overdue">√úberf√§llig</button>
                    <button class="filter-btn" data-filter="all">Alle</button>
                    <button class="filter-btn" data-filter="completed">Nur Erledigte</button>
                    
                    <!-- Category Filter Dropdown -->
                    <div class="filter-dropdown">
                        <select id="categoryFilter" class="filter-select" onchange="filterTasks('category')">
                            <option value="">üìÅ Alle Kategorien</option>
                        </select>
                    </div>
                    
                    <!-- Priority Filter Dropdown -->
                    <div class="filter-dropdown">
                        <select id="priorityFilter" class="filter-select" onchange="filterTasks('priority')">
                            <option value="">‚ö° Alle Priorit√§ten</option>
                            <option value="high">üî¥ Hoch</option>
                            <option value="medium">üü° Mittel</option>
                            <option value="low">üü¢ Niedrig</option>
                        </select>
                    </div>
                </div>
                <div class="sort-section">
                    <button class="sort-btn active" data-sort="priority">Nach Priorit√§t</button>
                    <button class="sort-btn" data-sort="category">Nach Kategorie</button>
                    <button class="sort-btn" data-sort="due-date">Nach Datum</button>
                    <button class="sort-btn" data-sort="title">Nach Titel</button>
                    <label class="toggle-switch">
                        <input type="checkbox" id="hideCompletedToggle" onchange="toggleCompletedTasks()">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Erledigte ausblenden</span>
                    </label>
                </div>
            </div>
            
            <!-- Bulk Actions Bar -->
            <div id="bulkActions" class="bulk-actions-bar" style="display: none;">
                <div class="bulk-actions-info">
                    <span id="selectedCount">0</span> Tasks ausgew√§hlt
                </div>
                <div class="bulk-actions-buttons">
                    <button class="btn btn-small btn-secondary" onclick="selectAllTasks()">Alle ausw√§hlen</button>
                    <button class="btn btn-small btn-secondary" onclick="deselectAllTasks()">Auswahl aufheben</button>
                    
                    <!-- Bulk Category Change -->
                    <div class="bulk-action-group">
                        <select id="bulkCategorySelect" class="bulk-select" onchange="bulkChangeCategory()">
                            <option value="">üìÅ Kategorie √§ndern</option>
                        </select>
                    </div>
                    
                    <!-- Bulk Priority Change -->
                    <div class="bulk-action-group">
                        <select id="bulkPrioritySelect" class="bulk-select" onchange="bulkChangePriority()">
                            <option value="">‚ö° Priorit√§t √§ndern</option>
                            <option value="high">üî¥ Hoch</option>
                            <option value="medium">üü° Mittel</option>
                            <option value="low">üü¢ Niedrig</option>
                        </select>
                    </div>
                    
                    <!-- Bulk Status Change -->
                    <div class="bulk-action-group">
                        <select id="bulkStatusSelect" class="bulk-select" onchange="bulkChangeStatus()">
                            <option value="">üìã Status √§ndern</option>
                            <option value="pending">‚è≥ Offen</option>
                            <option value="completed">‚úÖ Erledigt</option>
                        </select>
                    </div>
                    
                    <!-- Bulk Delete -->
                    <button class="btn btn-small btn-danger" onclick="bulkDeleteTasks()" title="Ausgew√§hlte Tasks l√∂schen">
                        üóëÔ∏è L√∂schen
                    </button>
                </div>
            </div>
            
            <!-- Tasks Container -->
            <div class="tasks-container" data-tasks-container>
                <div class="loading-indicator" data-loading style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Lade Tasks...</p>
                </div>
                <!-- Tasks werden hier dynamisch eingef√ºgt -->
            </div>
            
            <!-- Task Statistics -->
            <div class="task-stats">
                <div class="stat-item">
                    <span class="stat-label">Gesamt:</span>
                    <span class="stat-value" id="totalTasks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Offen:</span>
                    <span class="stat-value" id="pendingTasks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Erledigt:</span>
                    <span class="stat-value" id="completedTasks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Heute:</span>
                    <span class="stat-value" id="todayTasks">0</span>
                </div>
            </div>
        </div>
        
        <!-- Mistral AI Chat - Right Side -->
        <div class="mistral-chat">
            <div class="chat-header">
                <h2>ü§ñ Mistral AI Assistant</h2>
                <p>Intelligente Task-Unterst√ºtzung</p>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message ai-message">
                    <div class="message-content">
                        <p>üëã Hallo! Ich bin dein AI-Assistent f√ºr Task-Management.</p>
                        <p>Du kannst mich fragen:</p>
                        <ul>
                            <li>"Erstelle einen Task f√ºr morgen"</li>
                            <li>"Zeige mir alle Tasks von heute"</li>
                            <li>"L√∂sche alle Tasks der Kategorie 'Test'"</li>
                            <li>"Verschiebe alle Arbeit-Tasks auf n√§chste Woche"</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Frage Mistral AI..." onkeypress="handleChatKeyPress(event)">
                    <button class="chat-send-btn" onclick="sendMistralMessage()" title="Nachricht senden">
                        üì§
                    </button>
                </div>
                <div class="chat-status" id="chatStatus"></div>
            </div>
        </div>
    </div>

    <!-- Modulare JavaScript-Architektur -->
    <script src="js/services/ApiService.js"></script>
    <script src="js/modules/APIManager.js"></script>
    <script src="js/modules/TaskService.js"></script>
    <script src="js/modules/UIComponent.js"></script>
    <script src="js/modules/LegacyCompatibility.js"></script>
    
    <!-- Initialisierung -->
    <script>
        
        // Initialize modulare Architektur
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisiere modulare Architektur...');
            
            // Pr√ºfe und aktualisiere Datum automatisch
            try {
                dateSync.checkAndUpdateDate();
                console.log('‚úÖ DateSync erfolgreich');
            } catch (error) {
                console.error('‚ùå DateSync Fehler:', error);
            }
            
            // Initialize Flatpickr for date picker
            try {
                flatpickr("#taskDueDate", {
                    dateFormat: "Y-m-d",
                    locale: flatpickr.l10ns.de,
                    allowInput: false,
                    clickOpens: true,
                    placeholder: "Datum ausw√§hlen...",
                    minDate: "today",
                    firstDayOfWeek: 1,
                    weekNumbers: true
                });
                console.log('‚úÖ Flatpickr initialisiert');
            } catch (error) {
                console.error('‚ùå Flatpickr Fehler:', error);
            }
            
            // Initialize UIComponent
            try {
                window.uiComponent = new UIComponent();
                window.uiComponent.initialize();
                console.log('‚úÖ UIComponent initialisiert');
                
                // Initialize Legacy Compatibility
                window.legacyCompatibility = new LegacyCompatibility(window.uiComponent);
                console.log('‚úÖ LegacyCompatibility initialisiert');
            } catch (error) {
                console.error('‚ùå UIComponent Fehler:', error);
            }
            
            console.log('üéâ Modulare Architektur erfolgreich initialisiert!');
        });
    </script>
</body>
</html>
